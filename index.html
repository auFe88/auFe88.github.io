<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Rival's Covid</title>
    <style>
        .body {
            background-color: #2e2e2e;
        }
    </style>
</head>
<body class="body">
    <canvas id="canvas"></canvas>
    <script>
        'use strict';

        var canvas = document.getElementById('canvas');
        var context = canvas.getContext('2d');

        var currentLevel = 0;
        var target = [1, 1];
        var playerMoveX = 0;
        var tick_count = 0;

        //–ü—Ä–µ–¥–º–µ—Ç—ã
        var player, obstacles, stairs, masks, points, pills, radios;

        //–î–µ–∫–æ—Ä–∞—Ü–∏–∏
        var bgDec;
        var bgOpenDec;
        var tableDec;
        var chairDec;
        var bgColorDec;
        var textWindowDec;
        var textRadioDec;

        var CANVAS_WIDTH = 1280;
        var CANVAS_HEIGHT = 720;
        var FPS = 60;

        var then, now, elapsed, fpsInterval;

        //–ú–∞—Ç—Ä–∏–∞–ª—ã
        var playerr = new Image();
        var playerl = new Image();
        var playerf = new Image();
        var bg = new Image();
        var mask = new Image();
        var playerr_mask = new Image();
        var playerl_mask = new Image();
        var playerf_mask = new Image();
        var table = new Image();
        var bgOpen = new Image();
        var pill = new Image();
        var chair = new Image();
        var bgColor = new Image();
        var radio = new Image();
        var textWindow = new Image();
        var textRadio = new Image();

        //–ê—É–¥–∏–æ
        var walking = new Audio();
        var PJump = new Audio();
        var bgAudio = new Audio();
        var openWindow = new Audio();
        var closeWindow = new Audio();
        var breathe = new Audio();
        var drink = new Audio();
        var putOn = new Audio();
        var putOff = new Audio();
        var lamp = new Audio();
        var radioAudio = new Audio();

        //–ü—Ä–æ—á–µ–µ
        mask.src = 'img/maska.png';
        bg.src = 'img/bg.png';
        playerl.src = 'img/playerl.png';
        playerr.src = "img/playerr.png";
        playerf.src = 'img/playerf.png';
        playerl_mask.src = 'img/playerl_mask.png';
        playerr_mask.src = "img/playerr_mask.png";
        playerf_mask.src = 'img/playerf_mask.png';
        table.src = 'img/table.png';
        bgOpen.src = 'img/bgOpen.png';
        pill.src = 'img/tabletka.png';
        chair.src = 'img/chair.png';
        bgColor.src = 'img/bgColor.png';
        radio.src = 'img/radio.png';
        textWindow.src = 'img/textWindow.png';
        textRadio.src = 'img/textRadio.png';

        //–ê—É–¥–∏–æ
        bgAudio.src = 'audio/bgAudio.wav';
        walking.src = 'audio/walk.wav';
        PJump.src = 'audio/jump.wav';
        openWindow.src = 'audio/openWindow.wav';
        closeWindow.src = 'audio/closeWindow.wav';
        breathe.src = 'audio/breathe.wav';
        drink.src = 'audio/drink.wav';
        putOn.src = 'audio/putOn.wav';
        putOff.src = 'audio/putOff.wav';
        lamp.src = 'audio/lamp.wav';
        radioAudio.src = 'audio/radio.wav';

        canvas.width = CANVAS_WIDTH;
        canvas.height = CANVAS_HEIGHT;

        var setLevel = function(lvl) {
            if (lvl === 0) {
                player = {
                    xPrev: 0,
                    yPrev: 0,
                    width: 160,
                    height: 365,
                    x: CANVAS_WIDTH / 2,
                    y: CANVAS_HEIGHT,
                    xVelocity: 0,
                    yVelocity: 0,
                    jumping: true,
                    masks: 0
                };
                pills = [
                    {
                        width: 50,
                        height: 50,
                        x: 700,
                        y: 295
                    }
                ];
                radios = [
                    {
                        width: 100,
                        height: 100,
                        x: 210,
                        y: 530
                    }
                ];
                points = [
                    {
                        x: 900,
                        y: 400,
                        width: 200,
                        height: 100
                    }
                ];
                textWindowDec = {
                    x: 935,
                    y: 125
                }
                textRadioDec = {
                    x: 255,
                    y: 470
                }
                chairDec = {
                    x: 600,
                    y: 400
                }
                bgDec = {
                    x: 0,
                    y: 0
                };
                bgOpenDec = {
                    x: -1280,
                    y: 0
                };
                masks = [
                    {
                        width: 50,
                        height: 50,
                        x: 470,
                        y: 335
                    }
                ];
                tableDec = {
                    x: 450,
                    y: 453
                },
                bgColorDec = {
                    x: 0,
                    y: 0,
                }
            }
            window.addEventListener("keydown", controller.KeyListener);
            window.addEventListener("keyup", controller.KeyListener);
        }

        var controller = {
            ause: false,
            use: false,
            takeoff: false,
            left: false,
            right: false,
            KeyListener: function(evt) {
                var keyState = (evt.type == "keydown") ? true : false;
                switch (evt.keyCode) {
                    case 37:
                        controller.left = keyState;
                        break;
                    case 39:
                        controller.right = keyState;
                        break;
                    case 71:
                        controller.takeoff = keyState;
                        break;
                    case 69:
                        controller.use = keyState;
                        break;
                    case 82:
                        controller.ause =keyState;
                        break;
                }
            }
        };

        var startAnimation = function(fps) {
            setLevel(currentLevel);
            fpsInterval = 1000 / fps;
            then = window.performance.now();
            animation(then);
        }

        var animation = function(newTime) {
            window.requestAnimationFrame(animation);
            now = newTime;
            elapsed = now - then;
            if (elapsed > fpsInterval) {
                then = now - (elapsed % fpsInterval);
                update();
                draw();
            }
        }

        var isCollided = function(obst, obj) {
            if (obj.x + obj.width > obst.x 
            && obj.x < obst.x + obst.width
            && obj.y < obst.y + obst.height
            && obj.y + obj.height > obst.y) {
                return true;
            } else {
                return false;
            }
        }

        var collideHandler = function(obst, obj) {
            if (isCollided(obst, obj)) {
                if (obj.xPrev >= obst.x + obst.width) {
                    obj.x = obst.x + obst.width;
                    obj.xVelocity = 0;
                }
                if (obj.xPrev + obj.width <= obst.x) {
                    obj.x = obst.x - obj.width;
                    obj.xVelocity = 0;
                }
                if (obj.yPrev + obj.height <= obst.y) {
                    obj.y = obst.y - obj.height;
                    obj.yVelocity = 0;
                    obj.jumping = false;
                }
                if (obj.yPrev >= obst.y + obst.height) {
                    obj.y = obst.y + obst.height;
                    obj.yVelocity = 0;
                }
            }
        }
        var maskHandler = function (mask, obj) {
            if(isCollided(mask, obj) && controller.use === true) {
                player.masks += 1;
                alert('–ù–∞–¥–µ–≤ –º–∞—Å–∫—É –≤—ã –æ–±–µ–∑–æ–ø–∞—Å–∏—Ç–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –º–∞–≥–∞–∑–∏–Ω–æ–≤, –≤–æ–¥–∏—Ç–µ–ª–µ–π –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ –∏ —Å–ª—É–∂–∞—â–∏—Ö –º—É–Ω–∏—Ü–∏–ø–∞–ª—å–Ω—ã—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π –æ—Ç —Ç–µ—Ö, —É –∫–æ–≥–æ –∫–æ—Ä–æ–Ω–∞–≤–∏—Ä—É—Å –ø—Ä–æ—Ö–æ–¥–∏—Ç –±–µ–∑ —Å–∏–º–ø—Ç–æ–º–æ–≤. –ï—â–µ –æ–¥–Ω–∏–º –ø–ª—é—Å–æ–º –º–∞—Å–∫–∏ —Å—á–∏—Ç–∞–µ—Ç—Å—è —Ç–æ, —á—Ç–æ –µ–µ –Ω–æ—à–µ–Ω–∏–µ –ª–∏—à–Ω–∏–π —Ä–∞–∑ –Ω–∞–ø–æ–º–∏–Ω–∞–µ—Ç, —á—Ç–æ –Ω–µ —Å–ª–µ–¥—É–µ—Ç –∫–∞—Å–∞—Ç—å—Å—è —Ä—É–∫–∞–º–∏ –ª–∏—Ü–∞, —á—Ç–æ–±—ã –≤–∏—Ä—É—Å –Ω–µ –ø–æ–ø–∞–ª –≤ —Å–ª–∏–∑–∏—Å—Ç—É—é –æ–±–æ–ª–æ—á–∫—É —Ä—Ç–∞, –Ω–æ—Å–∞ –∏–ª–∏ –≥–ª–∞–∑. –ù—É –∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π –∞—Ä–≥—É–º–µ–Ω—Ç ‚Äî –≤–∏–¥ –ª—é–¥–µ–π –≤ –º–∞—Å–∫–∞—Ö –∑–∞—Å—Ç–∞–≤–ª—è–µ—Ç —Å–µ—Ä—å–µ–∑–Ω–æ –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞—Ç—å —É–≥—Ä–æ–∑—É –ø–∞–Ω–¥–µ–º–∏–∏.');
                controller.use = false;
                putOn.volume = 0.25;
                putOn.play();
            }
        };
        var radioHandler = function (radio, obj) {
            if(isCollided(radio, obj) && controller.use === true) {
                alert('–° –ø–æ–º–æ—â—å—é —Å—Ä–µ–¥—Å—Ç–≤ –º–∞—Å—Å–æ–≤–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –º–æ–∂–Ω–æ —Å–ª–µ–¥–∏—Ç—å –∑–∞ —Ä–∞–∑–≤–∏—Ç–∏–µ–º –≤–∏—Ä—É—Å–∞ –∏ —É–∑–Ω–∞–≤–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏ –æ–± —ç—Ç–æ–º.');
                controller.use = false;
                radioAudio.volume = 0.15;
                radioAudio.play();
            }
        };
        var pillHandler = function (pill, obj) {
            if(isCollided(pill, obj) && controller.use === true) {
                for (var i = 0; i < pills.length; i++) {
                    pills[i].x = -1000;
                alert('–í—ã–ø–∏–≤ –ª–µ–∫–∞—Ä—Å—Ç–≤–æ –¥–ª—è —É–∫—Ä–µ–ø–ª–µ–Ω–∏—è –∏–º–º—É–Ω–∏—Ç–µ—Ç–∞, –≤—ã –∑–∞—â–∏—â–∞–µ—Ç–µ –æ—Ä–≥–∞–Ω–∏–∑–º –æ—Ç —á—É–∂–µ—Ä–æ–¥–Ω—ã—Ö –≤—Ç–æ—Ä–∂–µ–Ω–∏–π: –≤–∏—Ä—É—Å–æ–≤, –º–∏–∫—Ä–æ–±–æ–≤, –≥—Ä–∏–±–∫–æ–≤, –±–∞–∫—Ç–µ—Ä–∏–π, –ø—Ä–æ—Å—Ç–µ–π—à–∏—Ö –∏ –¥–∞–∂–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∫–ª–µ—Ç–æ–∫, –∫–æ—Ç–æ—Ä—ã–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å –≤ —Ö–æ–¥–µ –º—É—Ç–∞—Ü–∏–∏. –¢–µ–º —Å–∞–º—ã–º –≤—ã –∑–∞—â–∏—à–∞–µ—Ç–µ —Å–µ–±—è –æ—Ç –≤–∏—Ä—É—Å–∞.');
                controller.use = false;
                drink.volume = 0.5;
                drink.play();
                }
            }
        };
        var pointHandler = function (point, obj) {
            if (isCollided(point, obj) && controller.use === true && bgOpenDec.x === -1280) {
                bgOpenDec.x = 0;
                alert('–û—Ç–∫—Ä—ã–≤ –æ–∫–Ω–æ –≤—ã –æ—á–∏—â–∞–µ—Ç–µ –≤–æ–∑–¥—É—Ö –æ—Ç –ø—ã–ª–∏, –∞–ª–ª–µ—Ä–≥–µ–Ω–æ–≤, –¥—ã–º–∞ –∏ –Ω–µ–ø—Ä–∏—è—Ç–Ω—ã—Ö –∑–∞–ø–∞—Ö–æ–≤. —É–¥–∞–ª—è—é—Ç –Ω–µ–ø—Ä–∏—è—Ç–Ω—ã–µ –∑–∞–ø–∞—Ö–∏, –ø–æ–≥–ª–æ—â–∞—é—Ç –≤—Ä–µ–¥–Ω—ã–µ –≤–µ—â–µ—Å—Ç–≤–∞.');
                controller.use = false;
                openWindow.play();
                    
            } 
            else if (isCollided(point, obj) && controller.ause === true && bgOpenDec.x === 0) {
                bgOpenDec.x = -1280;
                controller.use = false;
                closeWindow.play();
            }
        };

        //–õ–∏–º–∏—Ç –¥–≤–∏–∂–µ–Ω–∏—è
        var limitMoveing = function() {
            
            if (player.x < 230 - player.width) {
                player.x = 230 - player.width;
            }
            if (player.x > 1250 - player.width) {
                player.x = 1250 - player.width;
            }
            if (player.y < 450 - player.height) {
                player.y = 450 - player.height;
                player.yVelocity = 0;
                player.jumping = false;
            }
            if (player.y > 680 - player.height) {
                player.y = 680 - player.height;
                player.yVelocity = 0;
                player.jumping = false;
            }
        }
        var update = function () {
            player.xPrev = player.x;
            player.yPrev = player.y;

            if (controller.takeoff) {
                player.masks = 0;
                putOff.volume = 0.25;
                putOff.play();
            };
            if (controller.left) {
                player.xVelocity -= 1;
            };
            if (controller.right) {
                player.xVelocity += 1;
            };
            player.yVelocity += 1.5;
            player.x += player.xVelocity;
            player.y += player.yVelocity;
            player.xVelocity *= 0.825;
            player.yVelocity *= 0.9;

            // –ó–≤—É–∫ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Å–æ–ø—Ä–∏–∫–æ—Å–Ω–æ–≤–µ–Ω–∏–∏
            if (controller.left) {
                player.jumping = true;
                walking.volume = 0.75;
                walking.play();

            }
            if (controller.right) {
                player.jumping = true;
                walking.volume = 0.75;
                walking.play();
            }

            if (player.x < 0) {
                player.x = 0;
            }

            limitMoveing();

            //–°–æ–ø—Ä–∏–∫–æ—Å–Ω–æ–≤–µ–Ω–∏—è
            for (var i = 0; i < radios.length; i++) {
                radioHandler(radios[i],  player );
            }
            for (var i = 0; i < pills.length; i++) {
                pillHandler(pills[i],  player );
            }
            for (var i = 0; i < masks.length; i++) {
                maskHandler(masks[i], player);
            }
            for (var i = 0; i < points.length; i++) {
                pointHandler(points[i], player);
            }
        };

        var drawObject = function(obj, style) {
            context.fillStyle = style;
            context.fillRect(obj.x, obj.y, obj.width, obj.height);
        }
        playerl,playerr,playerl_mask,playerr_mask.onload = function () {
            tick();
            requestAnimationFrame(tick);
        };
        var tick = function () {
            if (tick_count > 2) {
                draw();
                tick_count = 0;
            }
            tick_count += 1;
            requestAnimationFrame(tick);
        };
        var spriteLeft = function() {
            if (player.masks >= 1) {
            playerMoveX = (playerMoveX === 152 ? 0 : playerMoveX + 152);
            context.drawImage(playerl_mask, playerMoveX, 0, 152, 350, player.x, player.y, 152, 330);
            breathe.volume = 0.15;
            breathe.play();
            } else {
                playerMoveX = (playerMoveX === 152 ? 0 : playerMoveX + 152);
                context.drawImage(playerl, playerMoveX, 0, 152, 350, player.x, player.y, 152, 330);
            }
        };
        var spriteRight = function() {
            if (player.masks >= 1) {
                playerMoveX = (playerMoveX === 152 ? 0 : playerMoveX + 152);
                context.drawImage(playerr_mask, playerMoveX, 0, 152, 350, player.x, player.y, 152, 330);
                breathe.volume = 0.15;
                breathe.play();
            } else {
                playerMoveX = (playerMoveX === 152 ? 0 : playerMoveX + 152);
                context.drawImage(playerr, playerMoveX, 0, 152, 350, player.x, player.y, 152, 330);
            }
        };
        //–î–≤–∏–∂–µ–Ω–∏—è –∏–≥—Ä–æ–∫–∞
        var playerMove = function() {
            if (controller.right && controller.left === false) {
                spriteRight();
                bgAudio.volume = 0.05;
                bgAudio.loop = true;
                bgAudio.play();
                lamp.volume = 0.35;
                lamp.loop = true;
                lamp.play();
            }
            else if (controller.left && controller.right === false) {
                spriteLeft();
                bgAudio.volume = 0.05;
                bgAudio.loop = true;
                bgAudio.play();
                lamp.volume = 0.35;
                lamp.loop = true;
                lamp.play();
            }
            else if (player.masks >= 1) {
                context.drawImage(playerf_mask, player.x, player.y, 100, 315);
                breathe.volume = 0.15;
                breathe.play();
            } else {
                context.drawImage(playerf, player.x, player.y, 100, 315);
            }
        };  

        //----------------------------------------------------------------------------------
        var draw = function() {
            for (var i = 0; i < points.length; i++) {
                context.fillRect(points[i].x, points[i].y, points[i].width, points[i].height);
            }
            //–§–æ–Ω
            context.drawImage(bgColor, bgColorDec.x, bgColorDec.y);
            context.drawImage(bg, bgDec.x, bgDec.y);
            context.drawImage(bgOpen, bgOpenDec.x, bgOpenDec.y);
            //–°—Ç–æ–ª
            context.drawImage(table, tableDec.x, tableDec.y);
            //–°—Ç—É–ª
            context.drawImage(chair, chairDec.x, chairDec.y);
            //–¢–µ–∫—Å—Ç
            context.drawImage(textWindow, textWindowDec.x, textWindowDec.y);
            context.drawImage(textRadio, textRadioDec.x, textRadioDec.y);
            //–ú–∞—Å–∫–∏
            for (var i = 0; i < masks.length; i++) {
                context.drawImage(mask, masks[i].x, masks[i].y);
            };
            //–¢–∞–±–ª–µ—Ç–∫–∏
            for (var i = 0; i < pills.length; i++) {
                context.drawImage(pill, pills[i].x, pills[i].y);
            };
            for (var i = 0; i < radios.length; i++) {
                context.drawImage(radio, radios[i].x, radios[i].y);
            };
            //–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫
            context.fillStyle = 'white';
            context.font = 'normal 20px Arial';
            context.fillText('ü†î ü†ñ - –¥–≤–∏–≥–∞—Ç—å—Å—è        E - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å        R - –∑–∞–∫—Ä—ã—Ç—å –æ–∫–Ω–æ        G - —Å–Ω—è—Ç—å –º–∞—Å–∫—É', 285, 38);
            // –î–≤–∏–∂–µ–Ω–∏—è –∏–≥—Ä–æ–∫–∞
            playerMove();
        }
        startAnimation(FPS);
    </script>
</body>
</html>